<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style_car.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <title>จองคิวรถ</title>
</head>

<div class="top-navbar">
    <nav class="nav-links">
        <div><a href="contact.html">ติดต่อเรา</a></div>
        <div class="dropdown">
            <img src="image/user.png" alt="Logo" class="nav-logo">
            <div class="dropdown-menu">
                <a href="profile.html">โปรไฟล์</a>
                <a href="order-history.html">ประวัติคำสั่งซื้อ</a>
                <a href="claim.html">เคลมสินค้า</a>
                <a href="logout.html">ออกจากระบบ</a>
            </div>
        </div>
        <a href="index.html">
            <img src="image/united-states-of-america.png" alt="Logo" class="nav-logo">
        </a>
    </nav>
</div>

<!-- Navbar ชั้นล่าง -->
<div class="main-navbar">
    <nav class="nav-links">
        <div><a href="index.html">หน้าแรก</a></div>
        <div><a href="reservation_car.html" style="color: #FFB898;">จองคิวรถ</a></div>
        <a href="index.html">
            <img src="image/Logo.png" alt="Logo" class="nav-logo1">
        </a>
        <div><a href="shopping.html">ซื้อ/เช่าอุปกรณ์ทางการแพทย์</a></div>
    </nav>
    <div class="cart-icon">
        <a href="cart.html">
            <i class="fas fa-shopping-cart"></i>
        </a>
    </div>
</div>

<div class="search-section">
    <div class="search-container">
        <input type="text" placeholder="ค้นหา..." class="search-input">
        <button class="search-button">
            <i class="fas fa-search"></i> <!-- ไอคอนแว่นขยาย -->
        </button>
    </div>
</div>

<body>
    <!-- ปฏิทิน -->
    <div class="calendar-container">
        <div class="calendar-header">
            <button id="prev-month">&lt;</button>
            <div class="month-year-display">
                <span id="selected-month">
                    <h3>มกราคม</h3>
                </span>
                <span id="selected-year">
                    <h3>2567</h3>
                </span>
            </div>
            <button id="next-month">&gt;</button>
        </div>
        <table class="calendar-table">
            <thead>
                <tr>
                    <th class="header-day">อา</th>
                    <th class="header-day">จ</th>
                    <th class="header-day">อ</th>
                    <th class="header-day">พ</th>
                    <th class="header-day">พฤ</th>
                    <th class="header-day">ศ</th>
                    <th class="header-day">ส</th>
                </tr>
            </thead>
            <tbody id="calendar-body">
                <!-- ตารางวันที่ -->
            </tbody>
        </table>

        <!-- Modal สำหรับแสดงตารางเวลา -->
        <div id="calendar-event-modal" class="event-modal">
            <div class="event-modal-content">
                <span class="close-event-modal">&times;</span>
                <h3 id="modal-date-title">ตารางเวลา</h3>
                <div class="radio">
                    <label>
                        <input type="radio" id="ambulance" name="booking-type" class="vehicle-radio">
                        จองสำหรับรับส่งผู้ป่วย
                    </label>
                    <label>
                        <input type="radio" id="event" name="booking-type" class="vehicle-radio"> จองสำหรับงาน Event
                    </label>
                </div>
                <div class="radio">
                    <label>
                        <input type="radio" id="fist" name="level" class="first"> ระดับ 1
                    </label>
                    <label>
                        <input type="radio" id="basic" name="level" class="basic"> ระดับ 2
                    </label>
                    <label>
                        <input type="radio" id="advanced" name="level" class="advanced"> ระดับ 3
                    </label>
                </div>

                <div class="event-schedule">
                    <div class="schedule-column">
                        <div class="time-slot" data-time="08:00 - 09:00">08:00 - 09:00</div>
                        <div class="time-slot" data-time="09:00 - 10:00">09:00 - 10:00</div>
                        <div class="time-slot" data-time="10:00 - 11:00">10:00 - 11:00</div>
                        <div class="time-slot" data-time="11:00 - 12:00">11:00 - 12:00</div>
                        <div class="time-slot" data-time="12:00 - 13:00">12:00 - 13:00</div>
                        <div class="time-slot" data-time="13:00 - 14:00">13:00 - 14:00</div>
                        <div class="time-slot" data-time="14:00 - 15:00">14:00 - 15:00</div>
                        <div class="time-slot" data-time="15:00 - 16:00">15:00 - 16:00</div>
                    </div>
                    <div class="schedule-column">
                        <div class="time-slot" data-time="16:00 - 17:00">16:00 - 17:00</div>
                        <div class="time-slot" data-time="17:00 - 18:00">17:00 - 18:00</div>
                        <div class="time-slot" data-time="18:00 - 19:00">18:00 - 19:00</div>
                        <div class="time-slot" data-time="19:00 - 20:00">19:00 - 20:00</div>
                        <div class="time-slot" data-time="20:00 - 21:00">20:00 - 21:00</div>
                        <div class="time-slot" data-time="21:00 - 22:00">21:00 - 22:00</div>
                        <div class="time-slot" data-time="22:00 - 23:00">22:00 - 23:00</div>
                        <div class="time-slot" data-time="23:00 - 00:00">23:00 - 00:00</div>
                    </div>
                </div>
                <button id="confirm-selection" class="confirm-btn">ยืนยัน</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const calendarBody = document.getElementById("calendar-body");
            const selectedMonth = document.getElementById("selected-month");
            const selectedYear = document.getElementById("selected-year");
            const prevMonthBtn = document.getElementById("prev-month");
            const nextMonthBtn = document.getElementById("next-month");

            const months = [
                "มกราคม", "กุมภาพันธ์", "มีนาคม", "เมษายน", "พฤษภาคม",
                "มิถุนายน", "กรกฎาคม", "สิงหาคม", "กันยายน", "ตุลาคม", "พฤศจิกายน", "ธันวาคม"
            ];

            let currentDate = new Date();
            let currentMonth = currentDate.getMonth();
            let currentYear = currentDate.getFullYear();

            function renderCalendar(month, year) {
                calendarBody.innerHTML = "";
                const firstDay = new Date(year, month).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();

                let date = 1;

                for (let i = 0; i < 6; i++) {
                    const row = document.createElement("tr");

                    for (let j = 0; j < 7; j++) {
                        const cell = document.createElement("td");

                        if (i === 0 && j < firstDay) {
                            cell.innerHTML = "";
                        } else if (date > daysInMonth) {
                            break;
                        } else {
                            const today = new Date();
                            const isPastDate = new Date(year, month, date) < today.setHours(0, 0, 0, 0);

                            cell.innerHTML = date;
                            if (isPastDate) {
                                cell.classList.add("disabled");
                            } else {
                                cell.addEventListener("click", () => {
                                    document.querySelectorAll(".calendar-table td.active").forEach(td => {
                                        td.classList.remove("active");
                                    });
                                    cell.classList.add("active");

                                    // อัปเดต modal ให้แสดงตารางเวลา
                                    const modal = document.getElementById("calendar-event-modal");
                                    const modalTitle = document.getElementById("modal-date-title");
                                    modalTitle.innerText = `ตารางเวลา วันที่ ${cell.innerText} ${months[month]} ${year + 543}`;
                                    modal.style.display = "flex";

                                    // รีเซ็ทการเลือกเวลาใน Modal
                                    const timeSlots = document.querySelectorAll(".time-slot");
                                    timeSlots.forEach(slot => {
                                        slot.classList.remove("selected");
                                    });

                                    // ล้างการเลือกเวลาจากปุ่มยืนยัน
                                    const confirmBtn = document.getElementById("confirm-selection");
                                    confirmBtn.style.display = "none";

                                    // เก็บวันที่ที่เลือก
                                    const selectedDate = `${cell.innerText} ${months[month]} ${year + 543}`;
                                    localStorage.setItem("selectedDate", selectedDate);
                                });
                            }
                            date++;
                        }
                        row.appendChild(cell);
                    }
                    calendarBody.appendChild(row);
                }

                selectedMonth.innerText = months[month];
                selectedYear.innerText = year + 543; // แปลงเป็นปี พ.ศ.
            }

            prevMonthBtn.addEventListener("click", () => {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                renderCalendar(currentMonth, currentYear);
            });

            nextMonthBtn.addEventListener("click", () => {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                renderCalendar(currentMonth, currentYear);
            });

            renderCalendar(currentMonth, currentYear);
        });

        // ปิด modal เมื่อคลิกปุ่มปิด
        const closeModal = document.querySelector(".close-event-modal");
        closeModal.addEventListener("click", () => {
            document.getElementById("calendar-event-modal").style.display = "none";
        });

        // ปิด modal เมื่อคลิกข้างนอก modal
        window.addEventListener("click", (e) => {
            if (e.target == document.getElementById("calendar-event-modal")) {
                document.getElementById("calendar-event-modal").style.display = "none";
            }
        });

        document.addEventListener("DOMContentLoaded", () => {
            // ตรวจสอบว่าหน้าเพจถูกโหลดใหม่โดยสมบูรณ์
            if (performance.getEntriesByType("navigation")[0].type === "back_forward") {
                location.reload(); // รีเฟรชหน้าเพจเมื่อย้อนกลับ
                return;
            }

            localStorage.removeItem("bookingType");
            localStorage.removeItem("level");

            // รีเซ็ตการเลือกของปุ่มวิทยุทั้งหมด
            const allRadios = document.querySelectorAll('input[type="radio"]');
            allRadios.forEach(radio => {
                radio.checked = false; // ยกเลิกการเลือกทุกปุ่ม
            });

            // ตัวแปรสำหรับตรวจสอบการเลือก
            let isBookingTypeSelected = false;
            let isLevelSelected = false;

            const bookingTypeRadios = document.querySelectorAll('input[name="booking-type"]');
            const levelRadios = document.querySelectorAll('input[name="level"]');
            const timeSlots = document.querySelectorAll(".time-slot");
            const confirmBtn = document.getElementById("confirm-selection");

            // ตรวจสอบการเลือกประเภทการจอง
            bookingTypeRadios.forEach(radio => {
                radio.addEventListener("change", () => {
                    isBookingTypeSelected = true;
                    enableTimeSlots();
                });
            });

            // ตรวจสอบการเลือกระดับรถ
            levelRadios.forEach(radio => {
                radio.addEventListener("change", () => {
                    isLevelSelected = true;
                    enableTimeSlots();
                });
            });

            // ฟังก์ชันเปิดใช้งานการเลือกเวลาหากครบเงื่อนไข
            function enableTimeSlots() {
                if (isBookingTypeSelected && isLevelSelected) {
                    timeSlots.forEach(slot => {
                        slot.classList.remove("disabled"); // เปิดใช้งาน
                        slot.addEventListener("click", handleTimeSlotClick);
                    });
                }
            }

            // ฟังก์ชันจัดการการเลือกเวลา
            function handleTimeSlotClick(event) {
                const slot = event.currentTarget;
                slot.classList.toggle("selected");

                // เช็คว่ามีการเลือกเวลาอย่างน้อย 1 ช่วง
                const selectedSlots = document.querySelectorAll(".time-slot.selected");
                if (selectedSlots.length > 1) {
                    confirmBtn.style.display = "inline-block";
                } else {
                    confirmBtn.style.display = "none";
                }
            }

            // เพิ่มคลาส disabled กับช่วงเวลาเริ่มต้น
            timeSlots.forEach(slot => {
                slot.classList.add("disabled"); // ปิดการใช้งาน
                slot.removeEventListener("click", handleTimeSlotClick); // ลบ event listener
            });

            // ปุ่มยืนยัน
            confirmBtn.addEventListener("click", function () {
                const bookingType = document.querySelector('input[name="booking-type"]:checked');
                const level = document.querySelector('input[name="level"]:checked');

                if (!bookingType || !level) {
                    alert("กรุณาเลือกทั้งประเภทการจองและระดับ!");
                    return;
                }

                // เก็บค่าที่เลือกไว้ใน localStorage
                localStorage.setItem("bookingType", bookingType.id);
                localStorage.setItem("level", level.id);

                // ย้ายไปยังหน้าถัดไปตามค่าที่เลือก
                if (bookingType.id === "ambulance") {
                    window.location.href = "form_hospital.html";
                } else if (bookingType.id === "event") {
                    window.location.href = "form_event.html";
                }
            });
        });
    </script>

</body>

</html>